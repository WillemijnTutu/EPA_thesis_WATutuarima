import route_model_vis

from ema_workbench import Model, RealParameter, ScalarOutcome, BooleanParameter, Samplers
from ema_workbench import MultiprocessingEvaluator, ema_logging

from ema_workbench import save_results


import osmnx as ox

"""
Main method to run the experiment of the fugitive model

Here the experimental setup is inserted into the model and the number of replications is determined
After the model is run, the output statistics are displayed. 
"""
if __name__ == "__main__":

    route_model_instance = route_model_vis.route_model()

    print(route_model_instance.run_model(rational=False, seed=1000, strategy_change_percentage=0.1))

    exit(0)

    route_1 = [44207459, 44207965, 44212280, 44214617, 44216107, 44219637, 44221218, 44222735, 44226924, 2883965779, 44230469, 7274602907, 7274602906, 1735588804, 9051605499, 1735588817, 44234835, 300460498, 300460499, 44235910, 301662527, 6632266772, 44236404, 1433932968, 44236897, 6632266777, 44237532, 44238133, 44239518, 44239514, 44240183, 678516568, 44246402, 44246995, 44246400, 44244265, 44244801, 603628587, 44244264, 6247799169, 4258477988, 4258477969, 44248638, 678516021, 678516013, 44261682, 678515973, 9438161334, 9438132393, 44290011, 44293929, 44294838, 678516294, 44310675, 44311061, 5993528035, 2723662670, 3479454458, 3479454463, 44324605, 44324997, 44326771, 44331991, 44333781, 1426610346, 1426610348, 1426610337, 1435580711, 1435580737, 1435580729, 1435580715, 44366381, 44367972, 44374214, 44374971, 44379346, 44383961, 44385714, 3880908958, 770765440, 44381267, 576339854, 576339848, 605021424, 605021509, 44372041, 6486683953, 6486555637, 621460317, 6318429103, 6318429104, 6318429105, 6318429097, 621460298, 6486507730, 6486513550, 6486507702, 6486583753, 6486583749, 6486583748, 6486583740, 6486583741]
    edges_1 = []

    for i in range(0, len(route_1) - 2):
        edges_1.append((route_1[i], route_1[i+1]))

    route_2 = [44207459, 44207965, 44212280, 44214617, 44216107, 44219637, 44221218, 44222735, 44223243, 44224379, 44225421, 44225972, 3999526675, 1853293143, 44226921, 44224371, 44223239, 898862787, 44216098, 44216094, 44216090, 44216087, 44218071, 44225957, 44226441, 44231105, 44236880, 44238838, 44240644, 44243260, 44243764, 44244265, 44244801, 603628587, 44244264, 6247799169, 4258477988, 4258477969, 44248638, 678516021, 678516013, 44261682, 678515973, 9438161334, 9438132393, 44290011, 44293929, 44294838, 44298096, 726849079, 44300273, 44303161, 44305984, 44308518, 44314873, 4437582223, 770739496, 770739481, 770739483, 770739487, 770739485, 4213905403, 770739484, 44354503, 44354501, 44358484, 768930394, 1029946175, 1029946631, 1029946459, 768930368, 9492757051, 9492757062, 768930371, 768930373, 770813944, 9402428440, 670854722, 307156957, 768935955, 6602973694, 768935962, 768935963, 670854667, 670854670, 670854658, 44377336, 4708005930, 44380380, 2610317019, 44383529, 44386449, 44388467, 44390388, 3094601407, 847561819, 581886990, 44390118, 44389601, 6238815736, 44386428, 44385714, 3880908958, 770765440, 4002905731, 770765443, 6486723383, 6486723378, 6486723352, 6486723351, 6486723355, 6486723358, 6486723360, 6486683953, 6486555637, 621460317, 6318429103, 6318429104, 6318429105, 6318429097, 621460298, 6486507730, 6486513550, 6486507702, 6486583753, 6486583749, 6486583748, 6486583740, 6486583741]
    edges_2 = []

    for i in range(0, len(route_2) - 2):
        edges_2.append((route_2[i], route_2[i+1]))

    route_3 = [44207459, 44207965, 44212280, 44214617, 44216107, 44219637, 44221218, 44222735, 44226924, 2883965779, 44230469, 7274602907, 7274602906, 44234328, 733973200, 44237553, 44241712, 44242216, 44243270, 44243790, 44242723, 44242721, 44242213, 44247522, 44252976, 44255015, 44262228, 44263691, 44264779, 44266487, 44266485, 44269138, 44270545, 44271091, 44271608, 44271605, 44273740, 44275891, 44275888, 44277460, 44277459, 44277456, 44276889, 44276373, 44275883, 44274777, 44274255, 3665848146, 1687745613, 726799867, 300733721, 44287236, 1721153961, 546638050, 648837543, 648656105, 44298096, 726849079, 44300273, 44303161, 44305984, 44308518, 44314873, 4437582223, 770739496, 770739481, 770739483, 770739487, 770739485, 4213905403, 770739484, 44354503, 44354501, 44358484, 768930394, 44359186, 44356731, 773005448, 44357622, 44356727, 44357198, 4718288447, 9492712545, 44359922, 1029946459, 768930368, 9492757051, 9492757062, 768930371, 768930373, 770813944, 9402428440, 670854722, 307156957, 768935955, 6602973694, 768935962, 768935963, 670854667, 670854670, 670854658, 44377336, 4708005930, 44380380, 2610317019, 44383529, 44386449, 44388467, 44390388, 3094601407, 4715777206, 4715777207, 581886990, 44390118, 44389601, 6238815736, 44386428, 44385714, 3880908958, 770765440, 4002905731, 770765443, 6486723383, 6486723378, 6486723352, 6486723351, 6486723355, 6486723358, 6486723360, 6486683953, 6486555637, 621460317, 6318429103, 6318429104, 6318429105, 6318429097, 621460298, 6486507730, 6486513550, 6486507702, 6486583753, 6486583749, 6486583748, 6486583740, 6486583741]
    edges_3 = []

    for i in range(0, len(route_3) - 2):
     edges_3.append((route_3[i], route_3[i + 1]))

    print(route_1 == route_2)
    print(route_2 == route_3)

    # exit(0)
    #
    source = 44207459
    sink = 6486583741
    #
    default_graph_file_path = "graph/graph_base_case.graphml"
    graph_OW_False = ox.load_graphml(default_graph_file_path)

    node_colors = []
    node_size = []
    edge_colors = []
    edge_size = []
    for index in graph_OW_False.nodes():
        if index == source:
            node_colors.append('red')
            node_size.append(30)
        elif index == sink:
            node_colors.append('tab:blue')
            node_size.append(30)
        elif index in route_1:
            node_size.append(1)
            node_colors.append('black')
        elif index in route_2:
            node_size.append(1)
            node_colors.append('orange')
        elif index in route_3:
            node_size.append(1)
            node_colors.append('yellow')
        else:
            node_colors.append("lightgray")
            node_size.append(0)

    for (u, v) in graph_OW_False.edges():
        if (u, v) in edges_1:
            edge_colors.append('black')
            edge_size.append(2)
        elif (v, u) in edges_1:
            edge_colors.append('black')
            edge_size.append(2)
        elif (u, v) in edges_2:
            edge_colors.append('orange')
            edge_size.append(2)
        elif (v, u) in edges_2:
            edge_colors.append('orange')
            edge_size.append(2)
        elif (u, v) in edges_3:
            edge_colors.append('yellow')
            edge_size.append(2)
        elif (v, u) in edges_3:
            edge_colors.append('yellow')
            edge_size.append(2)
        else:
            edge_colors.append('lightgray')
            edge_size.append(0.5)

    file_path = "test.png"

    ox.plot.plot_graph(
        graph_OW_False,
        bgcolor="white", node_color=node_colors, node_size=node_size, edge_linewidth=edge_size,
        edge_color=edge_colors,
        show=False, save=True, filepath=file_path
    )
